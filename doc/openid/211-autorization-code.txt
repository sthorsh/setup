AUTHORIZATION_CODE

EU/UA
  Kaller RP
  Velger login
  
----------
RP
  Redirecter UA til OP /auth

Rq /auth
  response_type=code
  client_id=CLIENT_ID
  redirect_uri=REDIRECT_URI
  scope=openid SCOPE
  response_mode=RESPONSE_MODE
  nonce=NONCE
  state=STATE
  prompt=none|login|consent|select_account

OP
  Validerer CLIENT_ID
  Validerer REDIRECT_URI
  Bruker autentiserer seg
  Bruker autoriserer skop
  Genererer CODE
  Redirecter UA til REDIRECT_URI

Rs /auth
  code: CODE
  state: STATE

---------
RP
  Validerer STATE
  Kaller OP /token

Rq /token
  grant_type=authorization_code
  client_id=CLIENT_ID
  client_secret=CLIENT_SECRET
  redirect_uri=REDIRECT_URI
  code=CODE

OP
  Validerer CLIENT_ID
  Validerer CLIENT_SECRET
  Genererer ACCESS_TOKEN
  Genererer ID_TOKEN signert med private key

Rs /token
  id_token: ID_TOKEN
  access_token: ACCESS_TOKEN
  token_type: Bearer
  expires_in: 3600

RP
  Validerer ID_TOKEN payload
  Validerer ID_TOKEN signatur
  Kaller OP /userinfo og/eller RS /api

------------
Rq /userinfo
  ACCESS_TOKEN
  
OP
  Validerer ACCESS_TOKEN
  
Rs /userinfo
  sub: 123456789
  name: John Doe
  email: john@doe.com

RP
  Validerer OP TLS sertifikat
  Dekrypterer respons (hvis kryptert)
  Validerer OP signatur (hvis signert)
  Validerer idtoken sub = userinfo sub
  
------------
Rq /api
  ACCESS_TOKEN
  
RS
  Alt1: validerer ACCESS_TOKEN
  Alt2: sender ACCESS_TOKEN til OP for validering
  
Rs /api
  Iht GET|POST|PUT|PATH|DELETE
