AUTORISASJONSKODE

Start
  UA kaller klient
  Klient redirecter UA til AZS /auth

---------------
Autorisasjon RQ
  GET /auth
    ?response_type=code  
    &client_id=CLIENT_ID
    &redirect_uri=REDIRECT_URI 
    &response_mode=query (opt)
    &state=STATE (opt) 
    &scope=API1.TYPE API2.TYPE ... (opt)
  Host: AZS

AZS prosesserer
  Validerer CLIENT_ID
  Validerer REDIRECT_URI
  Autentiserer bruker (login)
  Autoriserer klient (samtykke)
  Genererer AUTH_CODE
  Redirecter UA til REDIRECT_URI

Autorisasjon RS
  GET /callback 
    ?code=AUTH_CODE 
    &state=STATE (opt)
  Host: klient

Klient prosesserer
  Validerer STATE
  Kaller AZS /token

--------
Token RQ
  POST /token HTTP/1.1
  Host: AZS
  Content-type: application/x-www-form-urlencoded
  Authorization: Basic base64(CLIENT_ID + ":" + CLIENT_SECRET) (RFC 7617, alt RFC 6749)
  ...
  grant_type=authorization_code
  &redirect_uri=REDIRECT_URI
  &code=AUTH_CODE&

AZS prosesserer
  Validerer CLIENT_ID
  Autentiserer klient vha CLIENT_SECRET
  Genererer ACCESS_TOKEN e.g JWT, ustrukterte data

Token RS
  HTTP/1.1 200 OK
  Content-Type: application/json
  {
    access_token: ACCESS_TOKEN
    token_type: Bearer,
    expires_in: 3600,
    scope: API1.TYPE (opt)
  }

------
API RQ
  GET|POST|... /api HTTP/1.1
  Host: RS
  Authorization: Bearer ACCESS_TOKEN
  ...

Ressurs prosesserer
  Alt1: validering i ressursen
  Alt2: sende til AZS for validering
  Validerer at utsteder er AZS
  Validerer bruker som har delegert tilgang (hvem)
  Validerer skopet som brukeren har delegert (hva)

API RS
  JSON

