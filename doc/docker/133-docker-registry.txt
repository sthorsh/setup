DOCKER REGISTRY

Setup
  Container + CA_crt
  Container + self-signed_crt
  Installed service + CA_crt (*.*.fifty.eu)
✓ Installed service + self-signed_crt (acme.com)

Install + start
  $ sudo apt update 
  $ sudo apt install docker-registry
  $ sudo service docker-registry start
  $ sudo service docker-registry status

Cfg
  /etc/docker/registry/config.yml

Data
  /var/lib/docker-registry/docker/registry/v2/repositories/...

List images
  $ curl localhost:5000/v2/_catalog
  $ curl 192.168.0.7:5000/v2/_catalog

Pull fra DR
  $ docker pull localhost:5000/hello-world:latest

Push til DR
  $ docker pull hello-world
  $ docker tag hello-world localhost:5000/hello-world:latest
  $ docker push localhost:5000/hello-world:latest

Autentisering
  Basic (DR)
  Token (DR)
  Reverse proxy server

Autentisering
  Klient
   _$ sudo vim /etc/hosts → stuff.com 192.168.0.7
    $ docker pull bash
    $ docker tag bash stuff.com:5000/bash
    $ docker login stuff.com:5000
    $ docker push stuff.com:5000/bash 
    
  Server
    $ mkdir auth
    $ docker run --entrypoint htpasswd registry -Bbn svein password >> auth/htpasswd
    $ sudo vim /etc/docker/registry/config.yml → auth
    $ sudo service docker-registry restart
      
Kryptering: http/tls
  Klient
   _$ sudo vim /etc/hosts → stuff.com 192.168.0.7
   _$ mv stuff.crt ca.crt
   _$ sudo su
   _$ mkdir -p /etc/docker/certs.d/stuff.com:5000/
   _$ cp ca.crt /etc/docker/certs.d/stuff.com:5000/ 
   _$ exit
   _$ sudo service docker restart
    $ pull stuff.com:5000/hello-world
    $ curl --insecure https://stuff.com:5000/v2/_catalog
    
  Server
    $ mkdir certs
   _$ openssl req -newkey rsa:4096 -nodes -sha256 -keyout certs/stuff.key -x509 -days 365 -out certs/stuff.crt
    $ chmod 644 ~/certs/stuff.key
    $ vim /etc/docker/registry/config.yml → tls:
    $ sudo service docker-registry restart
   _$ scp stuff.crt svein@192.168.0.23:/home/svein (ikke for CA, kun for self-signed crt)

