IMPLISITT FLYT

EU/UA
    Kaller RP
    Velger LogIn
  
----------
RP
  Redirecter UA til OP /auth
  
Rq /auth
  response_type=idtoken [token]
  client_id=CLIENT_ID
  redirect_uri=REDIRECT_URI
  scope=openid SCOPE
  response_mode=RESPONSE_MODE
  nonce=NONCE
  state=STATE
  prompt=none|login|consent|select_account
  
OP
  Validerer CLIENT_ID
  Validerer REDIRECT_URI
  Bruker autentiserer seg
  Bruker autoriserer skop
  Genererer ID_TOKEN signert med private key
  Genererer ACCESS_TOKEN
  Redirecter UA til REDIRECT_URI
  
UA
  Sender tokens til REDIRECT_URI
  
Rs /auth
  id_token: ID_TOKEN
  access_token: ACCESS_TOKEN
  token_type: Bearer
  expires_in: 3600
  state: STATE
  session_expires_in: 600
  session_state: SESSION_STATE
  
RP
  Validerer STATE
  Validerer ID_TOKEN payload: iss, sub, aud, amr, nbf, exp, nonce, at-hash
  Validerer ID_TOKEN signatur: vha OP /discovery/v2.0/keys â†’ OP public key
  Kaller OP /userinfo og/eller RS /api
  
------------
Rq /userinfo
  ACCESS_TOKEN
  
OP
  Validerer ACCESS_TOKEN
  
Rs /userinfo
  sub: 123456789
  name: John Doe
  email: john@doe.com

RP
  Validerer OP TLS sertifikat
  Dekrypterer respons (hvis kryptert)
  Validerer OP signatur (hvis signert)
  Validerer idtoken sub = userinfo sub
  
------------
Rq /api
  ACCESS_TOKEN
  
RS
  Alt1: validerer ACCESS_TOKEN
  Alt2: sender ACCESS_TOKEN til OP for validering
  
Rs /api
  Iht GET|POST|PUT|PATH|DELETE
  
