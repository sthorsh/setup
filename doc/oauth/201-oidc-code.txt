OIDC CODE FLOW

Registrering
  Navn: APP_NAME
  Redirect URI: https://ws/callback

Akkreditiver
  Klient-ID: CLIENT_ID
  Klient-secret: CLIENT_SECRET
  
-----
Start
  Bruker kaller https://ws/index.js

---------------
Autorisasjon RQ
  https://azs/authorize?
    response_type=code id_token token&
    response_mode=form_post&
    client_id=CLIENT_ID&
    redirect_uri=https://ws/callback&
    scope=openid profile API&
    state=STATE

Autorisasjon
  AzS validerer client_id
  AzS validerer redirect_uri 
  Bruker autentiserer seg (login)
  Bruker autoriserer scope (samtykker)
  AzS genererer autorisasjonskode CODE

Autorisasjon RS                                        
  https://ws/callback?
    code=CODE&
    state=STATE
 
--------
Token RQ
  POST /token HTTP/1.1
    Host: azs
    Content-type: application/x-www-form-urlencoded
    ...
    grant_type=authorization_code&
    code=CODE&
    redirect_uri=https://ws/callback&
    client_id=CLIENT_ID&
    client_secret=CLIENT_SECRET

Token RS
  HTTP/1.1 200 OK
  Content-Type: application/json
  {
    access_token: JWT₁
    id_token: JWT₂
    token_type: Bearer,
    expires_in: 3600,
  }

-------------------------
Klient validerer id_token
  exp: EPOCH
  iss: https://idp
  aud: CLIENT_ID
  nonce: NONCE
  at_hash: AT_HASH
  sub: USER_ID
  idp: IDP
  amr: pwd
  ...

-----------
API RQ
  https://idp/userinfo 
  Authorization: Bearer ACCESS_TOKEN

API RS
  {
    sub: 248289761001,
    name: John Doe,
    email: johndoe@example.com
  }
------
API RQ
  https://rs/api
  Authorization: Bearer ACCESS_TOKEN

API RS
  Data JSON

